/*
 * Opera (.oex) Extensions Compatibility Layer - operaextensions_injectedscript.min.js
 * https://github.com/operasoftware/operaextensions.js (ver: 0.91)
 * Copyright (c) 2013 Opera Software ASA 
 * License: The MIT License (https://github.com/operasoftware/operaextensions.js/blob/master/LICENSE)
 */
!function(e){function A(a,b,c){r?a[b].apply(a,c):l.push({target:a,methodName:b,args:c})}var g=function(){};g.prototype.REVISION="1";g.prototype.version=function(){return this.REVISION};g.prototype.buildNumber=function(){return this.REVISION};g.prototype.postError=function(a){console.log(a)};var j,B=!1;try{opera?(j=opera,B=!0):j=new g}catch(S){j=new g}var F=null;try{F=chrome.app.getDetails()}catch(T){}e.navigator.browserLanguage=e.navigator.language;var r=!1,l=[],v={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},
s={},f="undefined"!==typeof window?window:{},f=f.MutationObserver||f.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))f=function(a,b){process.nextTick(function(){a.call(b)})};else if(f){var C=[],f=new f(function(){var a=C.slice();C=[];a.forEach(function(a){a[0].call(a[1])})}),G=document.createElement("div");f.observe(G,{attributes:!0});f=function(a,b){C.push([a,b]);G.setAttribute("drainQueue","drainQueue")}}else f=function(a,b){setTimeout(function(){a.call(b)},
1)};s.async=f;var H=s.Event=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},I=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c][0]===b)return c;return-1},w=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},m=s.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,c){for(var d=w(this),k,e,a=a.split(/\s+/),c=c||this;e=a.shift();)(k=d[e])||(k=d[e]=[]),-1===I(k,b)&&k.push([b,c])},off:function(a,
b){for(var c=w(this),d,k,a=a.split(/\s+/);d=a.shift();)b?(d=c[d],k=I(d,b),-1!==k&&d.splice(k,1)):c[d]=[]},trigger:function(a,b){var c,d,k,e;if(c=w(this)[a])for(var f=0,g=c.length;f<g;f++)d=c[f],k=d[0],d=d[1],"object"!==typeof b&&(b={detail:b}),e=new H(a,b),k.call(d,e)}},x=s.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},J=function(){},K=function(a,b,c,d){var e,
D;if(c)try{e=c(d.detail)}catch(f){D=f}else e=d.detail;if(e instanceof x)e.then(function(a){b.resolve(a)},function(a){b.reject(a)});else if(c&&e)b.resolve(e);else if(D)b.reject(D);else b[a](e)};x.prototype={then:function(a,b){var c=new x;this.on("promise:resolved",function(b){K("resolve",c,a,b)});this.on("promise:failed",function(a){K("reject",c,b,a)});return c},resolve:function(a){s.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=J},reject:function(a){s.async(function(){this.trigger("promise:failed",
{detail:a});this.isRejected=a},this);this.reject=this.resolve=J}};m.mixin(x.prototype);var n=function(a,b){var c=b||{},d=new CustomEvent(a,!0,!0),e;for(e in c)d[e]=c[e];return d},f=function(){m.mixin(this)};f.prototype.constructor=f;f.prototype.addEventListener=function(a,b){this.on(a,b)};f.prototype.removeEventListener=function(a,b){this.off(a,b)};f.prototype.dispatchEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,
a)};var y=function(a){m.mixin(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new n("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),a=function(a,c,d){var e=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new n("controlmessage",{data:a,source:{postMessage:function(a){e.postMessage(a)},
tabId:c&&c.tab?c.tab.id:null}})):A(this,"dispatchEvent",[new n("message",{data:a,source:{postMessage:function(a){e.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}})]);d&&d({})}.bind(this),this._localPort.onMessage.addListener(a),chrome.extension.onMessage.addListener(a),A(this,"dispatchEvent",[new n("connect",{source:this._localPort,origin:""})]))};y.prototype=Object.create(f.prototype);y.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};
var h=function(){y.call(this,!1)};h.prototype=Object.create(y.prototype);h.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});h.prototype.getScreenshot=function(a){var b=function(c){if(c.data&&c.data.action&&"___O_getScreenshot_RESPONSE"===c.data.action&&c.data.dataUrl){var d=document.createElement("canvas"),e=d.getContext("2d"),f=new Image;f.onload=function(){d.width=f.width;d.height=f.height;e.drawImage(f,0,0);var b=e.getImageData(0,0,d.width,d.height);
a.call(this,b)};f.src=c.data.dataUrl;i.removeEventListener("controlmessage",b)}}.bind(this);i.addEventListener("controlmessage",b);i.postMessage({action:"___O_getScreenshot_REQUEST"})};var i=j.extension=j.extension||new h,L=j.contexts=j.contexts||{};h.prototype.getFile=function(a){var b=null;if("string"!=typeof a)return b;try{var c=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(c)?c:"")+a,
d=new XMLHttpRequest;d.onloadend=function(){d.readyState==d.DONE&&200==d.status&&(result=d.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};d.open("GET",a,!1);d.responseType="blob";d.send(null)}catch(e){}return b};var o=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(o.prototype,"getItem",{value:function(a){a=this[a];return void 0===a?null:a}});Object.defineProperty(o.prototype,
"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==a)return a;b++}return null}});Object.defineProperty(o.prototype,"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||i.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(o.prototype,"setItem",{value:function(a,b,c){this[a]||this.length++;this[a]=b;c||i.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});
Object.defineProperty(o.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||i.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};o.prototype=Object.create(e.Storage.prototype);h=function(){m.mixin(this);this.properties=F||{};this._preferences=new o;this._preferencesSet={};i.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=
a.data.attrs[b];v.WIDGET_API_LOADED=!0;if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=a.data._prefs[b],this._preferences.length++;v.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);i.postMessage({action:"___O_widget_setup_REQUEST"})};
h.prototype=Object.create(f.prototype);h.prototype.__defineGetter__("name",function(){return this.properties.name||""});h.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});h.prototype.__defineGetter__("id",function(){return this.properties.id||""});h.prototype.__defineGetter__("description",function(){return this.properties.description||""});h.prototype.__defineGetter__("author",function(){return this.properties.author||""});h.prototype.__defineGetter__("authorHref",
function(){return this.properties.author?this.properties.author.href||"":""});h.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});h.prototype.__defineGetter__("version",function(){return this.properties.version||""});h.prototype.__defineGetter__("preferences",function(){return this._preferences});try{e.widget=widget||new h}catch(U){e.widget=new h}m.mixin(g.prototype);g.prototype.defineMagicVariable=function(a,b,c){if(!(void 0===
b||void 0===c)){var d={"[object Function]":1,"[object Null]":1};Object.prototype.toString.call(b)in d&&Object.prototype.toString.call(c)in d&&(d=document.createElement("script"),d.setAttribute("type","text/javascript"),"[object Function]"===Object.prototype.toString.call(b)&&(d.textContent+="window.__defineGetter__('"+a+"', "+b.toString()+");\n"),c&&"[object Function]"===Object.prototype.toString.call(c)&&(d.textContent+="window.__defineSetter__('"+a+"', "+c.toString()+");\n"),document.getElementsByTagName("head")[0].appendChild(d),
document.getElementsByTagName("head")[0].removeChild(d))}};g.prototype.defineMagicFunction=function(a,b){if(b&&"[object Function]"===Object.prototype.toString.call(b)){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.textContent="var "+a+" = "+b.toString()+";";document.getElementsByTagName("head")[0].appendChild(c);document.getElementsByTagName("head")[0].removeChild(c)}};g.prototype.addEventListener=function(a,b){this.on(a,b);var c=a.split(/\./),d=this;/beforeevent(listener|)/i.test(c[0])&&
c[1]?document.addEventListener(c[1],function(c){b.call(d,{type:a,event:c,preventDefault:function(){c.stopPropagation()}})},!0):console.log("Warning: no support for "+a+" events")};g.prototype.removeEventListener=function(){};g.prototype.__defineGetter__("scriptStorage",function(){return widget.preferences});g.prototype.setOverrideHistoryNavigationMode=function(){};g.prototype.__defineGetter__("getOverrideHistoryNavigationMode",function(){return"automatic"});var E,M=null;document.addEventListener("contextmenu",
function(a){M=a.srcElement},!1);E=function(a,b,c){a=n(a,{documentURL:b.info.pageUrl,pageURL:b.info.pageUrl,isEditable:b.info.editable,linkURL:b.info.linkUrl||null,mediaType:b.info.mediaType||null,selectionText:b.info.selectionText||null,source:null,srcURL:b.info.srcUrl||null});Object.defineProperty(a,"target",{enumerable:!0,configurable:!1,get:function(){return c||null},set:function(){}});Object.defineProperty(a,"srcElement",{enumerable:!0,configurable:!1,get:function(a){return function(){return a||
null}}(M),set:function(){}});return a};E.prototype=Object.create(H.prototype);var z=function(){var a={};m.mixin(a);var b=null;Object.defineProperty(this,"onclick",{enumerable:!0,configurable:!1,get:function(){return b},set:function(a){null!=b&&this.removeEventListener("click",b,!1);b=a;null!=b&&b instanceof Function?this.addEventListener("click",b,!1):b=null}});Object.defineProperty(this,"dispatchEvent",{enumerable:!1,configurable:!1,writable:!1,value:function(b){var d=this,e=!1;Object.defineProperty(b,
"currentTarget",{enumerable:!0,configurable:!1,get:function(){return d},set:function(){}});Object.defineProperty(b,"stopImmediatePropagation",{enumerable:!0,configurable:!1,writable:!1,value:function(){e=!0}});var f=w(a)[b.type],g,h;if(f)for(var i=0,j=f.length;i<j;i++)g=f[i],h=g[0],g=g[1],e||h.call(g,b)}});Object.defineProperty(this,"addEventListener",{enumerable:!0,configurable:!1,writable:!1,value:function(b,d){a.on(b,d,this)}});Object.defineProperty(this,"removeEventListener",{enumerable:!0,configurable:!1,
writable:!1,value:function(b,d){a.off(b,d,this)}})},N=function(a){z.call(this);Object.defineProperty(this,"toString",{enumerable:!1,configurable:!1,writable:!1,value:function(){return"[object MenuItemProxy]"}});Object.defineProperty(this,"id",{enumerable:!0,configurable:!1,get:function(){return a},set:function(){}})};N.prototype=Object.create(z.prototype);g=function(){z.call(this);Object.defineProperty(this,"toString",{enumerable:!1,configurable:!1,writable:!1,value:function(){return"[object MenuContextProxy]"}});
i.addEventListener("controlmessage",function(a){a.data&&(a.data.action&&"___O_MenuItem_Click"===a.data.action)&&this.dispatchEvent(new E("click",{info:a.data.info,tab:null},new N(a.data.menuItemId)))}.bind(this))};g.prototype=Object.create(z.prototype);L.menu=L.menu||new g;g=function(){m.mixin(this);this.pageSrcElementsPointers={};this.pageSrcElements={};this.grabPageElements=function(){for(var a=e.document.querySelectorAll("[src],link[rel='stylesheet'][href],object[data],body[background]"),b=0,c=
a.length;b<c;b++){var d=a[b].src||a[b].href||a[b].data||a[b].background;a[b].origUrl=d;d=e.encodeURIComponent(d.split("#")[0]);void 0===this.pageSrcElements[d]&&(this.pageSrcElements[d]=[]);this.pageSrcElements[d].push(a[b])}};this.dispatchURLFilterEvent=function(a,b){this.pageSrcElements={};this.grabPageElements.call(this);var a=a+"",b=b||{url:"null"},c=e.encodeURIComponent(b.url.split("#")[0]);if(void 0==this.pageSrcElements[c]||null==this.pageSrcElements[c])this.dispatchEvent(new n(a,b));else{for(var d=
0,f=this.pageSrcElements[c].length;d<f;d++){var g=b;g.element=this.pageSrcElements[c][d];g.url=g.element?g.element.origUrl:g.url;this.dispatchEvent(new n(a,g))}this.pageSrcElements[c]=[]}};i.addEventListener("controlmessage",function(a){if(a.data&&a.data.action&&a.data.data)switch(a.data.action){case "___O_urlfilter_contentblocked":this.dispatchURLFilterEvent.call(this,"contentblocked",a.data.data);break;case "___O_urlfilter_contentunblocked":this.dispatchURLFilterEvent.call(this,"contentunblocked",
a.data.data);break;case "___O_urlfilter_contentallowed":this.dispatchURLFilterEvent.call(this,"contentallowed",a.data.data)}}.bind(this))};g.prototype=Object.create(f.prototype);g.prototype.addEventListener=function(a,b){a=(a+"").toLowerCase();this.on(a,b);A(i,"postMessage",[{action:"___O_urlfilter_DRAINQUEUE",eventType:a}])};i.urlfilter=i.urlfilter||new g;if(B)r=!0,opera.isReady=function(a){a.call(e);for(var a=0,b=l.length;a<b;a++){var c=l[a];c.target[c.methodName].apply(c.target,c.args)}l=[]};else{var g=
j,f=function(a,b){var c=a.addEventListener;a.addEventListener=function(d,f,g){d+="";d.toLowerCase()===b.toLowerCase()?void 0===f||(null===f||"[object Function]"!==Object.prototype.toString.call(f))||("domcontentloaded"===d.toLowerCase()&&!t||"load"===d.toLowerCase()&&!p||!r?q[b.toLowerCase()].push(f):f.call(e)):c.call(a,d,f,g)};a.__defineSetter__("on"+b.toLowerCase(),function(c){a.addEventListener(b.toLowerCase(),c,!1)})},u=function(a,b,c){var d=a.toLowerCase(),c=c||{};c.type=a;c.target||(c.target=
b||e);c.currentTarget||(c.currentTarget=c.target);c.srcElement||(c.srcElement=c.target);!0!==c.bubbles&&(c.bubbles=!1);!0!==c.cancelable&&(c.cancelable=!1);c.timeStamp||(c.timeStamp=0);for(var a=0,f=q[d].length;a<f;a++)q[d][a].call(b,c)},q={isready:[],readystatechange:[],domcontentloaded:[],load:[]},t=!1,p=!1;"interactive"===e.document.readyState&&(t=!0);"complete"===e.document.readyState&&(p=t=!0);e.document.addEventListener("DOMContentLoaded",function b(){t=true;e.document.removeEventListener("DOMContentLoaded",
b,true)},!0);e.addEventListener("load",function c(){p=true;e.removeEventListener("load",c,true)},!0);e.document.addEventListener("readystatechange",function(c){c.stopImmediatePropagation();c.stopPropagation();e.document.readyState!=="interactive"&&e.document.readyState!=="complete"?u("readystatechange",e.document):e.document.readyState="loading"},!0);var O=t||p?e.document.readyState:"loading";e.document.__defineSetter__("readyState",function(c){O=c});e.document.__defineGetter__("readyState",function(){return O});
f(e,"load");f(e.document,"domcontentloaded");f(e,"domcontentloaded");f(e.document,"readystatechange");var Q=(new Date).getTime()+24E4;(function d(){if((new Date).getTime()>=Q){console.warn("opera.isReady check timed out");p=true}else for(var f in v)if(v[f]!==true){e.setTimeout(function(){d()},20);return}e.setTimeout(function(){if(!r){for(var d=0,f=q.isready.length;d<f;d++)q.isready[d].call(e);q.isready=[];var g=(new Date).getTime()+12E4;(function P(){var d=(new Date).getTime();if(t||p||d>=g){e.document.readyState=
"interactive";u("readystatechange",e.document);u("domcontentloaded",e.document,{bubbles:true});d>=g&&console.warn("document.domcontentloaded event fired on check timeout");var f=(new Date).getTime()+12E4;(function R(){var d=(new Date).getTime();if(p||d>=f){e.document.readyState="complete";u("readystatechange",e.document);u("load",e);d>=f&&console.warn("window.load event fired on check timeout");for(var d=0,g=l.length;d<g;d++){var h=l[d];h.target[h.methodName].apply(h.target,h.args)}l=[]}else e.setTimeout(function(){R()},
50)})()}else e.setTimeout(function(){P()},50)})();r=true}},0)})();g.isReady=function(d){r?d.call(e):q.isready.push(d)}}B||(e.opera=j)}(window);
